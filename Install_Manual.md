# Text Automation 설치 매뉴얼

이 문서는 안드로이드 SMS를 PC에 자동으로 입력해주는 Text Automation 시스템의 전체 설치 과정을 안내합니다.

## 1. 전체 시스템 구조

이 시스템은 세 부분으로 구성되어 있습니다.

1.  **서버 (Server 폴더)**: 외부 서버에서 24시간 실행됩니다. 안드로이드 앱에서 모든 SMS를 수신하고, 웹소켓을 통해 PC 클라이언트와 연결을 유지하며, 필터 조건에 맞는 인증번호를 PC로 즉시 전송합니다.
2.  **PC 클라이언트 (client 폴더)**: 사용자의 개인 PC에서 실행됩니다. 서버와 항상 연결을 유지하다가, 서버가 인증번호를 보내주면 즉시 클립보드에 복사하고 활성화된 창에 붙여넣습니다.
3.  **안드로이드 앱 (app 폴더)**: 사용자의 휴대폰에 설치됩니다. 모든 SMS를 수신하여 서버로 전달하는 역할을 합니다.

---

## 2. 사전 준비물

-   **외부 서버**: 24시간 켜져 있을 수 있는 나만의 서버 (예: 클라우드 서비스의 가상 머신(VM), 개인 NAS 등)가 필요하며, 이 서버에는 **Docker**가 설치되어 있어야 합니다.
-   **개인 PC**: 인증번호를 입력받을 컴퓨터. **Python 3**가 설치되어 있어야 합니다.
-   **안드로이드 폰**: SMS를 수신할 스마트폰.

---

## 3. 설치 과정 (Step-by-Step)

### **1단계: 서버 설정 및 실행 (외부 서버에서 진행)**

이 작업은 구매하거나 준비한 **외부 서버**에 터미널로 접속해서 진행해야 합니다.

1.  **프로젝트 파일 업로드**:
    이 프로젝트의 `Server` 폴더 전체를 외부 서버의 특정 위치(예: `/home/user/`)에 업로드합니다.

2.  **데이터 저장 폴더 생성 (최초 1회)**:
    서버 터미널에서, 데이터베이스 파일(`database.db`)을 영구적으로 저장할 폴더를 생성합니다. 이 폴더는 컨테이너가 삭제되어도 데이터 보존을 위해 외부에 유지됩니다.
    ```shell
    # 예시: /home/user/sms_data 폴더 생성
    mkdir /home/user/sms_data
    ```

3.  **Docker 이미지 빌드**:
    업로드한 `Server` 폴더로 이동한 후, 다음 명령어를 실행하여 Docker 이미지를 만듭니다.
    ```shell
    cd /경로/to/your/Server
    docker build -t sms-server .
    ```

4.  **Docker 컨테이너 실행**:
    빌드된 이미지로 컨테이너를 실행합니다. `-v` 옵션을 통해 방금 만들었던 외부 폴더와 컨테이너 내부의 데이터 폴더를 연결(마운트)합니다. **이것이 데이터를 영구 보존하는 핵심입니다.**
    ```shell
    # 명령어의 `/home/user/sms_data` 부분을 실제 생성한 데이터 저장 폴더의 절대 경로로 변경하세요.
    docker run -d -p 5000:5000 -v /home/user/sms_data:/app/data --name my-sms-server --restart always sms-server
    ```

    > **[중요] 기존 버전에서 업그레이드 하는 경우**
    > 
    > 만약 이전 버전의 서버를 실행한 적이 있다면, 반드시 기존 컨테이너를 삭제하고 새 버전의 `docker run` 명령어를 실행해야 합니다.
    > ```shell
    > # 1. 기존 컨테이너 중지 및 삭제
    > docker stop my-sms-server
    > docker rm my-sms-server
    > 
    > # 2. (선택) 모든 데이터를 초기화하고 싶다면, 데이터 저장 폴더의 내용물을 삭제합니다.
    > # rm -rf /home/user/sms_data/* 
    > 
    > # 3. 이후 위의 4번 `docker run` 명령어를 다시 실행하여 새 컨테이너를 생성하세요.
    > ```

### **2단계: 대시보드 사용법 (웹 페이지 접속)**

PC의 웹 브라우저를 열고 주소창에 `http://<내 외부 서버의 공인 IP 주소>:5000` 으로 접속하면, SMS 관리를 위한 대시보드가 나타납니다.

1.  **필터 관리**:
    -   화면 좌측 카드에서 인증번호를 추출할 문자의 규칙(키워드 또는 발신자 번호)을 추가하거나 삭제할 수 있습니다.
    -   **중요: 이 필터를 하나 이상 추가해야 시스템이 문자를 감지하고 동작합니다.**

2.  **메시지 로그**:
    -   서버에 수신된 모든 SMS의 기록을 볼 수 있습니다.
    -   **검색 및 필터링**: 상단의 입력창을 통해 특정 내용으로 로그를 검색하거나 '처리 상태'(처리됨/처리 안됨)로 필터링할 수 있습니다.
    -   **선택 삭제**: 각 로그 옆의 체크박스를 선택하고 '선택 항목 삭제' 버튼을 눌러 원하는 기록만 삭제할 수 있습니다. (헤더의 체크박스로 전체 선택 가능)
    -   **Excel 내보내기**: 'Excel로 내보내기' 버튼을 눌러 현재까지 기록된 모든 메시지 로그를 Excel 파일로 다운로드할 수 있습니다.
    -   **페이지네이션**: 로그가 20개를 초과하면 하단에 페이지 번호가 나타나며, 페이지를 이동하여 이전 기록을 볼 수 있습니다.
    -   **테마 변경**: 화면 우측 상단의 아이콘(해/달)을 클릭하여 라이트 모드와 다크 모드를 전환할 수 있습니다. 선택한 테마는 브라우저에 저장됩니다.

### **3단계: PC 클라이언트 설정 및 실행 (개인 PC에서 진행)**

이제 인증번호를 실제로 붙여넣기 할 개인 PC에서 클라이언트를 실행합니다.

1.  **(최초 1회) 서버 주소 설정**:
    `config/settings.py` 파일을 열어 `PRIMARY_URL`과 `SECONDARY_URL`을 자신의 서버 주소에 맞게 수정합니다. `PRIMARY_URL`은 기본 서버 주소, `SECONDARY_URL`은 예비 서버 주소입니다.
    ```python
    # 예시
    PRIMARY_URL = "https://your-domain.com"
    SECONDARY_URL = "http://your-server-ip:8312"
    ```

2.  **(최초 1회) 필요 라이브러리 설치**:
    PC의 터미널(CMD, PowerShell 등)을 열고, 이 프로젝트의 `client` 폴더로 이동합니다. 그 후, 다음 명령어로 클라이언트에 필요한 라이브러리들을 설치합니다.
    ```shell
    cd /경로/to/your/client
    pip install -r requirements.txt
    ```

3.  **클라이언트 실행**:
    터미널에서 다음 명령어로 클라이언트를 실행합니다.
    ```shell
    python pc_client.py
    ```
    터미널에 `Successfully connected to...` 메시지가 나타나면 서버와 성공적으로 연결된 것입니다. **이 터미널 창은 인증번호를 받는 동안 계속 켜두어야 합니다.**

### **4단계: 안드로이드 앱 설정**

1.  직접 빌드한 안드로이드 앱을 휴대폰에 설치하고 실행합니다.
2.  앱의 "Host address"를 입력하는 설정 화면으로 갑니다.
3.  `http://<내 외부 서버의 공인 IP 주소>:5000` 형식으로 서버 주소를 입력하고 저장합니다. **(주의: 주소 끝에 `/sms` 같은 경로는 붙이지 않습니다.)**
4.  앱이 요구하는 SMS 수신, 인터넷 접근 등의 권한을 모두 허용합니다.

---

## 4. 문제 해결 (Troubleshooting)

-   **PC 클라이언트가 서버에 연결되지 않을 때**:
    -   `config/settings.py` 파일에 `PRIMARY_URL`과 `SECONDARY_URL`이 올바르게 입력되었는지 다시 확인하세요.
    -   외부 서버에서 `docker ps` 명령어로 `my-sms-server` 컨테이너가 실행 중인지 확인하세요.
    -   외부 서버의 방화벽이 5000번 포트를 허용하는지 확인하세요.

-   **인증번호가 자동으로 입력되지 않을 때**:
    -   PC 클라이언트 터미널에 오류 메시지가 없는지 확인하세요.
    -   서버의 웹 UI(`http://<서버 IP>:5000`)에 접속하여 필터가 올바르게 설정되었는지 확인하세요.
    -   `docker logs my-sms-server` 명령어로 서버 로그를 확인하여, 안드로이드 앱으로부터 SMS가 제대로 수신되고 있는지 확인하세요.
    -   안드로이드 앱의 Host 주소가 올바른지, 필요한 모든 권한이 허용되었는지 확인하세요.

---

## 5. 서버 완전 삭제 및 초기화

서버를 더 이상 운영하지 않거나, 모든 설정을 처음부터 다시 시작하고 싶을 때 아래의 명령어를 외부 서버 터미널에서 실행하세요.

### **1. 컨테이너 중지 및 삭제**

현재 실행 중인 서버 프로그램을 중지하고 삭제합니다. (데이터와 이미지는 남아있습니다.)

```shell
docker stop my-sms-server
docker rm my-sms-server
```

### **2. 모든 데이터 삭제 (로그 초기화)**

지금까지 수신된 모든 SMS 로그를 완전히 삭제하고 싶을 때 실행합니다. Docker 볼륨으로 데이터가 외부 폴더에 저장되므로, 컨테이너를 삭제해도 데이터는 사라지지 않습니다. 데이터를 지우려면 **반드시 외부 데이터 폴더를 직접 삭제**해야 합니다.

```shell
# 예시: 1단계에서 생성했던 데이터 저장 폴더의 내용물을 삭제
rm -rf /home/user/sms_data/*
```

### **3. 도커 이미지 삭제**

서버를 다시는 사용하지 않을 경우, 빌드했던 Docker 이미지까지 삭제하여 용량을 확보할 수 있습니다.

```shell
docker rmi sms-server
```
